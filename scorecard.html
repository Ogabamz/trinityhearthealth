<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trinity Heart Health Scorecard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <!-- ✅ Meta Pixel Code (Correct & Active) -->
  <script>
    !function(f, b, e, v, n, t, s) {
      if (f.fbq) return;
      n = f.fbq = function() {
        n.callMethod ?
          n.callMethod.apply(n, arguments) : n.queue.push(arguments)
      };
      if (!f._fbq) f._fbq = n;
      n.push = n;
      n.loaded = !0;
      n.version = '2.0';
      n.queue = [];
      t = b.createElement(e);
      t.async = !0;
      t.src = v;
      s = b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t, s)
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '31576639681951470'); // ✅ Corrected Pixel ID format
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
         src="https://www.facebook.com/tr?id=31576639681951470&ev=PageView&noscript=1"/>
  </noscript>
  <!-- ✅ End Meta Pixel Code -->
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-red-700 text-white py-6 text-center">
    <h1 class="text-3xl font-bold">Trinity Heart Health Scorecard</h1>
    <p class="mt-2 text-lg">Pastor, check your heart health stewardship in just 3 minutes</p>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-10">
    <section id="assessmentSection" class="bg-white shadow-lg rounded-xl p-6 mb-8">
      <h2 class="text-xl font-semibold mb-3">Why take this assessment?</h2>
      <p class="mb-4">Your calling demands strength, stamina, and longevity. This scorecard will help you identify where you stand today and what steps you can take to preserve your health for many more years of service.</p>
      <p class="font-medium">Answer honestly. Your results are private.</p>
    </section>

    <section id="questionsSection" class="bg-white shadow-lg rounded-xl p-6 space-y-6">
      <h2 class="text-lg font-semibold mb-4">Start Your Assessment</h2>
      <div id="assessmentQuestions"></div>
      <div class="text-center">
        <button id="submitBtn" class="bg-red-700 hover:bg-red-800 text-white font-semibold px-6 py-3 rounded-xl shadow-lg">Submit Assessment</button>
      </div>
    </section>

    <form id="pastorInfoSection" style="display:none;" class="bg-white shadow-lg rounded-xl p-6 space-y-4" autocomplete="off">
      <h3 class="text-lg font-semibold mb-4">Your Personal Information</h3>

      <input type="text" name="First Name" placeholder="First Name" class="w-full border rounded-lg p-2" required>

      <input type="text" name="Last Name" placeholder="Last Name" class="w-full border rounded-lg p-2" required>

      <input type="email" name="Email" placeholder="Email Address" class="w-full border rounded-lg p-2">

      <input type="text" name="Phone" placeholder="WhatsApp Number (e.g. 0803...)" class="w-full border rounded-lg p-2" required>

      <input type="text" name="City" placeholder="City or State" class="w-full border rounded-lg p-2" required>

      <input type="hidden" name="Event Type" value="Lead">
      <input type="hidden" name="Event Time" id="eventTime">
      <input type="hidden" name="Event Source URL" id="eventSource">

      <div class="text-center">
        <button type="submit" class="bg-green-700 hover:bg-green-800 text-white font-semibold px-6 py-3 rounded-xl shadow-lg">Submit & See My Results</button>
      </div>
    </form>
  </main>

  <footer class="bg-gray-800 text-white py-6 mt-10 text-center">
    <p>&copy; 2025 Trinity Heart Health. All Rights Reserved.</p>
  </footer>

  <script>
    // Questions and options
const questions = [
  "How often do you feel short of breath during or after preaching?",
  "Do you regularly experience dizziness, headaches, or chest tightness?",
  "How many hours of restful sleep do you get each night?",
  "How often do you feel fully energized when you wake up?",
  "How would you rate your stamina during long services?",
  "How many days a week do you eat fruits and vegetables?",
  "Do you regularly eat fried or processed foods?",
  "How often do you drink at least 2 liters of water daily?",
  "Do you take supplements consistently?",
  "How often do you eat late at night after church activities?",
  "How often do you feel overwhelmed by ministry responsibilities?",
  "Do you set aside time for rest each week?",
  "How often do you pray specifically for your health?",
  "Do you believe poor health could limit your calling?",
  "How often do you teach your congregation about health?",
  "How confident are you that you can preach actively for the next 10 years?",
  "Do you have a family history of high blood pressure or heart disease?",
  "How often do you go for medical checkups or BP monitoring?",
  "How prepared is your ministry if your health fails temporarily?",
  "Do you see yourself still preaching actively past the age of 70?"
 
];

const options = [
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Less than 4", "4-5", "6", "7", "8 or more"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Very Poor", "Poor", "Average", "Good", "Excellent"],
  ["0 days", "1-2 days", "3-4 days", "5-6 days", "Daily"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"],
  ["Never", "Rarely", "Sometimes", "Often", "Always"],
  ["Not Confident", "Slightly Confident", "Moderately Confident", "Confident", "Very Confident"],
  ["No", "Yes, minor", "Yes, moderate", "Yes, severe", "Not Sure"],
  ["Never", "Rarely", "Sometimes", "Often", "Regularly"],
  ["Not Prepared", "Slightly Prepared", "Moderately Prepared", "Well Prepared", "Fully Prepared"],
  ["Not at all", "Unlikely", "Not Sure", "Likely", "Definitely"]
  
];

// Render questions
const container = document.getElementById('assessmentQuestions');
questions.forEach((q, i) => {
  const div = document.createElement('div');
  div.className = 'mb-4';
  div.innerHTML = `<label class='block mb-2 font-medium'>${i + 1}. ${q}</label><select name='q${i + 1}' class='w-full border rounded-lg p-2' required><option value=''>Select an option</option>${options[i].map(o => `<option>${o}</option>`).join('')}</select>`;
  container.appendChild(div);
});

// Show info form after assessment
document.getElementById('submitBtn').addEventListener('click', () => {
  const allAnswered = Array.from(document.querySelectorAll('#assessmentQuestions select')).every(s => s.value);
  if (!allAnswered) return alert('Please answer all questions.');
  document.getElementById('questionsSection').style.display = 'none';
  document.getElementById('pastorInfoSection').style.display = 'block';
});

// Helper: get value by name from FormData
function getFormValue(formData, name) {
  return formData.get(name) ? formData.get(name).trim() : '';
}

// On submit, send all required fields to Google Sheet
document.getElementById('pastorInfoSection').addEventListener('submit', async (e) => {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);

  // Add Event Time and Source
  formData.set('Event Time', new Date().toISOString());
  formData.set('Event Source URL', window.location.href);

  // Also collect the answers to the 20 questions
  for (let i = 1; i <= questions.length; i++) {
    const sel = document.querySelector(`select[name="q${i}"]`);
    if (sel) {
      formData.set(`Q${i}`, sel.value);
    }
  }

  // Convert FormData to URL-encoded string for compatibility with Apps Script parsing
  const params = new URLSearchParams();
  formData.forEach((value, key) => {
    params.append(key, value);
  });

  try {
    await fetch('https://script.google.com/macros/s/AKfycbxs0ImTg3lDGe9MXP3kSLd_GxCSPLBJLNmjeZIQ5mylyBNaJwHO9eUhkaCyA6wjTmZX/exec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      },
      body: params.toString()
    });

    fbq('track', 'Lead');

    window.location.href = 'post-submission.html';
  } catch (error) {
    console.error('Submission failed:', error);
    alert('Something went wrong. Please try again.');
  }
});
  </script>
</body>
</html>
